Проведи ревью кода для изменений в текущей ветке относительно мастера.

Для этого выполни следующие шаги:

1. Используй Haiku агента чтобы получить список путей к файлам (но не содержимое) всех релевантных CLAUDE.md файлов из кодовой базы: корневой CLAUDE.md файл (если существует), а также любые CLAUDE.md файлы в директориях, файлы которых были изменены в этой ветке
2. Используй Haiku агента чтобы просмотреть diff между текущей веткой и мастером (используй `git diff master...HEAD`), и попроси агента вернуть краткое описание изменений
3. Затем запусти 5 параллельных Sonnet агентов для независимого ревью кода. Агенты должны сделать следующее и вернуть список проблем с указанием причины для каждой (например, соответствие CLAUDE.md, баг, исторический git контекст и т.д.):
   a. Агент #1: Проверь изменения на соответствие CLAUDE.md. Учти что CLAUDE.md - это руководство для Claude при написании кода, поэтому не все инструкции будут применимы при ревью.
   b. Агент #2: Прочитай изменения в файлах, затем проведи поверхностное сканирование на очевидные баги. Избегай чтения дополнительного контекста за пределами изменений, фокусируйся только на самих изменениях. Сконцентрируйся на серьезных багах, избегай мелких проблем и придирок. Игнорируй вероятные ложные срабатывания.
   c. Агент #3: Прочитай git blame и историю изменённого кода, чтобы выявить баги в свете исторического контекста
   d. Агент #4: Прочитай предыдущие коммиты, которые касались этих файлов, и проверь есть ли комментарии в тех коммитах, которые могут также относиться к текущим изменениям.
   e. Агент #5: Прочитай комментарии в коде в изменённых файлах и убедись что изменения соответствуют любым указаниям в комментариях.
4. Для каждой найденной в п.3 проблемы запусти параллельного Haiku агента, который получит diff, описание проблемы и список CLAUDE.md файлов (из шага 1), и вернёт оценку уверенности агента в том, является ли проблема реальной или ложным срабатыванием. Для этого агент должен оценить каждую проблему по шкале от 0 до 100, указывая уровень уверенности. Для проблем, выявленных из-за инструкций CLAUDE.md, агент должен дважды проверить, что CLAUDE.md действительно упоминает эту проблему конкретно. Шкала (передай эту рубрику агенту дословно):
   a. 0: Совсем не уверен. Это ложное срабатывание, которое не выдерживает даже поверхностной проверки, или это уже существующая проблема.
   b. 25: Немного уверен. Это может быть реальной проблемой, но также может быть ложным срабатыванием. Агент не смог проверить что это реальная проблема. Если проблема стилистическая, она не была явно упомянута в соответствующем CLAUDE.md.
   c. 50: Умеренно уверен. Агент смог проверить что это реальная проблема, но она может быть придиркой или редко возникать на практике. По сравнению с остальными изменениями она не очень важна.
   d. 75: Очень уверен. Агент дважды проверил проблему и установил что с большой вероятностью это реальная проблема, которая проявится на практике. Существующий подход в изменениях недостаточен. Проблема очень важна и напрямую повлияет на функциональность кода, или это проблема, которая напрямую упомянута в соответствующем CLAUDE.md.
   e. 100: Абсолютно уверен. Агент дважды проверил проблему и подтвердил что это определённо реальная проблема, которая будет часто возникать на практике. Доказательства прямо это подтверждают.
5. Отфильтруй любые проблемы с оценкой меньше 80. Если нет проблем соответствующих этому критерию, не продолжай.
6. Наконец, выведи результат в stdout. При написании вывода учти следующее:
   a. Делай вывод кратким
   b. Избегай эмодзи
   c. Ссылайся и цитируй релевантный код, файлы и URL

Примеры ложных срабатываний для шагов 3 и 4:

- Уже существующие проблемы
- Что-то похожее на баг, но на самом деле не являющееся багом
- Педантичные придирки, на которые опытный инженер не обратил бы внимания
- Проблемы, которые поймает линтер, типчекер или компилятор (например, отсутствующие или неправильные импорты, ошибки типов, сломанные тесты, проблемы форматирования, педантичные стилистические проблемы вроде переносов строк). Не нужно запускать эти проверки самостоятельно -- можно безопасно предположить что они будут запущены отдельно как часть CI.
- Общие проблемы качества кода (например, отсутствие тестового покрытия, общие проблемы безопасности, плохая документация), если явно не требуется в CLAUDE.md
- Проблемы упомянутые в CLAUDE.md, но явно отключенные в коде (например, из-за lint ignore комментария)
- Изменения в функциональности, которые вероятно намеренные или напрямую связаны с более широким изменением
- Реальные проблемы, но на строках которые не были изменены

Примечания:

- Не проверяй сборку и не пытайся собрать или провести типчекинг приложения. Это будет запущено отдельно и не относится к ревью кода.
- Сначала создай todo список
- Ты должен цитировать и ссылаться на каждый баг (например, если ссылаешься на CLAUDE.md, ты должен сослаться на него)
- Для финального вывода следуй следующему формату точно (предположим в этом примере что найдено 3 проблемы):

---

### Ревью кода

Найдено 3 проблемы:

1. <краткое описание бага> (CLAUDE.md говорит "<...>")

`путь/к/файлу:начальная_строка-конечная_строка`

2. <краткое описание бага> (some/other/CLAUDE.md говорит "<...>")

`путь/к/файлу:начальная_строка-конечная_строка`

3. <краткое описание бага> (баг из-за <файл и фрагмент кода>)

`путь/к/файлу:начальная_строка-конечная_строка`


---

- Или, если не найдено проблем:

---

### Ревью кода

Проблем не найдено. Проверено на баги и соответствие CLAUDE.md.

---

- При ссылке на код используй формат `путь/к/файлу:начальная_строка-конечная_строка`
- Предоставь как минимум 1 строку контекста до и после, центрируя на строке о которой комментируешь (например, если комментируешь строки 5-6, ты должен сослаться на строки 4-7)
