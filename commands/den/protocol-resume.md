Ты — ИИ-агент, продолжающий прерванную работу. Твоя задача — безопасно восстановить свой контекст, проанализировав состояние проекта, и подготовиться к выполнению следующего шага.

**Входные данные:**

- Номер протокола = например PS-8575
- Если на вход не дали номер протокала, то берем его из ветки. К примеру если текущая ветка PS-4683_some_name, то задача PS-4683 и план ее лежит в anton/tasks/PS-4683

**Действуй по следующему алгоритму самодиагностики:**

### Фаза 1: Локализация и сбор данных

1.  **Найди папку:**

    - Протоколы лежат в папке `anton/tasks` и далее папка с именем задачи / протокола

2.  **Прочитай "официальный" статус:**
    - Открой файл состояния `anton/tasks/PS-XXXX/context.md`.
    - Внимательно изучи его содержимое. Запомни номер **текущего шага (`Current Step`)**.

### Фаза 2: Анализ и принятие решения

Теперь сравни собранные данные. Возможны три основных сценария:

#### **Сценарий A: Чистое состояние (самый частый)**

- **Условие:** `git status` пуст`.
- **Диагноз:** Работа была чисто прервана между шагами.
- **Действие:** Ты полностью готов к работе. Просто переходи к Фазе 3.

#### **Сценарий B: Прерывание в середине шага**

- **Условие:** `git status` показывает незакоммиченные изменения.
- **Диагноз:** Работа была прервана во время выполнения текущего шага.
- **Действие (согласно входным данным):**
  1.  Сообщи пользователю: "Обнаружены незавершенные изменения для шага `[Current Step]`."
  2.  Сообщи "Проверяю изменения и продолжаю работу." Внимательно изучи измененные файлы, проанализируй что уже сделано, а что не доделано, и переходи к Фазе 3 для продолжения выполнения шага.

#### **Сценарий C: Сбой после коммита, до обновления протокола**

- **Условие:** `git status` пуст, НО номер последнего коммита **равен** `Current Step`.
- **Диагноз:** Шаг был выполнен и закоммичен, но файлы протокола не успели обновиться.
- **Действие (Самокоррекция):**
  1.  Сообщи пользователю: "Обнаружена рассинхронизация. Шаг `[Current Step]` уже закоммичен, но протокол не обновлен. Выполняю коррекцию."
  2.  **Выполни пост-шаговые действия, которые не были сделаны:**
      - **Добавь запись в `log.md`:** Сформируй запись для завершенного шага, взяв информацию из сообщения последнего коммита (`git log -1`).
      - **Полностью перезапиши `context.md`**: Обнови `Current Step` (увеличь на 1), `Status`, `Last Action Summary` и `Next Action` для **следующего** шага.
      - Теперь мы работаем с указанным тобою Current Step.
  3.  Теперь ты в "чистом состоянии" и готов к следующему шагу. Переходи к Фазе 3.

### Фаза 3: Подготовка к работе

1.  **Добавь отметку о восстановлении контекста:**

    - Открой файл `anton/tasks/PS-XXXX/log.md`.
    - Посчитай, сколько раз в логе уже встречается запись `Restore context`.
    - Добавь в начало файла после заголовка новую запись: `Restore context: PS-XXXX#ctx-[новый_номер]`. (Например, если записей не было, будет `ctx-2`).

2.  **Прочитай инструкцию для следующего шага:**
    - Открой актуализированный `context.md` и посмотри на `Current Step` и `Next Action`.
    - Открой соответствующий файл шага (например, `anton/tasks/PS-XXXX/03-implement-feature.md`).
    - **Внимательно изучи его содержимое.** Это твой единственный источник информации для выполнения **следующего** шага.

### Фаза 4: Финальный отчет

Вернись к пользователю с отчетом о готовности.

**Пример отчета для Сценария B:**

> "Контекст восстановлен для протокола `PS-XXXX`. Я обнаружил незавершенные изменения для шага `03`, внимательно изучил их, и готов продолжить с места прерывания работы.
>
> **Текущее состояние:** {например, "Готов продолжить **шаг 03**"}
> **Моя следующая задача:** {Краткое описание следующего действия по шагу}

**Твоя работа начинается после того, как пользователь подтвердит, что ты можешь продолжать.**

После подтверждения от юзера:
- Приступай к реализации.
- После выполнения шага не останавливайся если не встретил неразрешимиго блокера.
- После окончания шага приступай к следующему пока не дойдешь по последнего 

